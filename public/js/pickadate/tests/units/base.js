var $DOM=$("#qunit-fixture"),$INPUT=$("<input type=password>"),isInteger=function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1==0};module("Base setup",{setup:function(){$DOM.append($INPUT.clone()),this.$input=$DOM.find("input").pickadate(),this.picker=this.$input.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Input stage and attributes",function(){var e=this.picker.$node[0];ok("text"===e.type,"Type updated"),ok(!0===e.readOnly,"Readonly set"),ok(""===e.value,"No value"),ok(this.picker.$root.length,"Root holder exists"),ok(!this.picker._hidden,"Hidden input doesn’t exist")}),test("Picker states",function(){var e=this.picker;ok(!0===e.get("start"),"Started"),ok(!1===e.get("open"),"Closed to start with"),e.open(),ok(!0===e.get("open"),"Opened with trigger"),e.$root.find("button")[0].focus(),ok(!0===e.get("open"),"Remains open with focus within"),e.$root.find("div").eq(3).click(),ok(!0===e.get("open"),"Remains open with click within"),e.close(),ok(!1===e.get("open"),"Closed with trigger"),e.stop(),ok(!1===e.get("start"),"Stopped with trigger"),e.start(),ok(!0===e.get("start"),"Started with trigger")}),test("Picker properties",function(){var e=this.picker;strictEqual(e.get("type"),"password","Original type is saved"),notStrictEqual(e.get("min").pick,null,"Has “min”"),notStrictEqual(e.get("max").pick,null,"Has “max”"),strictEqual(e.get("select"),null,"Has no “select”"),ok(isInteger(e.get("highlight").pick),"Has “highlight”"),ok(isInteger(e.get("view").pick),"Has “view”"),ok(isInteger(e.get("now").pick),"Has “now”"),deepEqual(e.get("disable"),[],"Default “disable” collection is empty")}),test("Picker alternate API",function(){var e=this.$input,t=this.picker;strictEqual(e.pickadate("get","start"),t.get("start"),"Methods are passed forward"),strictEqual(e.pickadate("component"),t.component,"Objects are passed forward")}),module("Formatting setup",{setup:function(){$DOM.append($INPUT.clone().attr("name","picker"));var e=$DOM.find("input").pickadate({formatSubmit:"yyyy/mm/dd"});this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Default hidden prefix & suffix",function(){var e=this.picker;strictEqual(e.$node[0].name+"_submit",e._hidden.name,"Correct hidden element `name`")}),module("Formatting setup",{setup:function(){$DOM.append($INPUT.clone().attr("name","picker"));var e=$DOM.find("input").pickadate({formatSubmit:"yyyy/mm/dd",hiddenPrefix:"prefixed__",hiddenSuffix:"__suffixed"});this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Custom hidden prefix & suffix",function(){var e=this.picker;strictEqual("prefixed__"+e.$node[0].name+"__suffixed",e._hidden.name,"Correct hidden element `name`")}),module("Formatting setup",{setup:function(){$DOM.append($INPUT.clone().attr("name","picker"));var e=$DOM.find("input").pickadate({formatSubmit:"yyyy/mm/dd",hiddenPrefix:"",hiddenSuffix:""});this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("No hidden prefix & suffix",function(){var e=this.picker;strictEqual(e.$node[0].name,e._hidden.name,"Correct hidden element `name`")}),module("Formatting setup",{setup:function(){$DOM.append($INPUT.clone().attr("name","picker"));var e=$DOM.find("input").pickadate({formatSubmit:"yyyy/mm/dd",hiddenName:!0});this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Hidden name replaces visible name",function(){var e=this.picker;strictEqual(e.$node[0].name,"","Visible element has no `name`"),strictEqual(e._hidden.name,"picker","Correct hidden element `name`")}),module("Container setup",{setup:function(){$DOM.append($INPUT.clone().attr("name","picker"),$('<div id="outlet"/>'));var e=$DOM.find("input").pickadate({formatSubmit:"yyyy/mm/dd",container:"#outlet"});this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Picker root outlet",function(){var e=this.picker;strictEqual(e.$root[0].parentNode.id,"outlet","Correct root outlet")}),module("Base events",{setup:function(){$DOM.append($INPUT.clone());var e=this,t=$DOM.find("input").pickadate({onStart:function(){e.started=!0,e.restarted=!0,e.inputType=this.$node[0].type},onRender:function(){e.rendered=!0},onOpen:function(){e.opened=!0},onClose:function(){e.closed=!0},onStop:function(){e.stopped=!0,e.inputType=this.$node[0].type},onSet:function(t){e.selected=t}});this.picker=t.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("As options",function(){var e=this,t=e.picker;strictEqual(e.started,!0===t.get("start"),"Fired: `onStart`"),strictEqual(e.inputType,"text","Updated input type"),strictEqual(e.rendered,!0===t.get("start"),"Fired: `onRender`"),t.open(),strictEqual(e.opened,!0===t.get("open"),"Fired: `onOpen`"),t.close(),strictEqual(e.closed,!1===t.get("open"),"Fired: `onClose`"),t.stop(),strictEqual(e.stopped,!1===t.get("start"),"Fired: `onStop`"),strictEqual(e.inputType,$INPUT[0].type,"Restored input type"),t.start(),strictEqual(e.restarted,!0===t.get("start"),"Restarted: `onStart`"),t.set(),deepEqual(e.selected,{},"Fired: `onSet`")}),test("As individual methods",6,function(){var e=this.picker;e.on("open",function(){ok(!0,"Opened")}).on("close",function(){ok(!0,"Closed")}).on("render",function(){ok(!0,"Rendered")}).on("set",function(){ok(!0,"Set")}).on("stop",function(){ok(!0,"Stopped")}).on("start",function(){ok(!0,"Started")}),e.trigger("start").trigger("open").trigger("render").trigger("set").trigger("close")}),test("As multiple methods",6,function(){var e=this.picker;e.on({open:function(){ok(!0,"Opened")},close:function(){ok(!0,"Closed")},render:function(){ok(!0,"Rendered")},set:function(){ok(!0,"Set")},stop:function(){ok(!0,"Stopped")},start:function(){ok(!0,"Started")}}),e.trigger("start").trigger("open").trigger("render").trigger("set").trigger("close")}),test("As muted methods",1,function(){var e=this.picker;e.on("set",function(){ok(!0,"An outspoken method")}),e.set("select",new Date),e.set("select",new Date,{muted:!0}),e.set({select:new Date},{muted:!0})}),test("Clear as muted",function(){var e=this.picker,t=!1;e.on("set",function(){t=!0}),e.clear({muted:!0}),ok(!t,"Callback not called")}),test("Open with alternate focus",function(){var e=this.picker,t=Picker.klasses();stop(),e.open(!1),setTimeout(function(){ok(!e.get("open")&&e.$node[0].className===t.input+" "+t.active&&e.$root[0].className===t.picker+" "+t.opened&&document.activeElement!==e.$node[0],"Opened without focus"),start()},0)}),test("Close with alternate focus",function(){var e=this.picker;stop(),e.close(!0),setTimeout(function(){var t=!e.get("open"),n=document.activeElement===e.$holder[0];ok(t&&n,"Closed with focus"),start()},0)}),test("Switch off",function(){var e=!0,t=this.picker;t.on("open",function(){e=!1}),t.off("open"),strictEqual(e,!0,"Method turned off")}),module("Base mouse events",{setup:function(){$DOM.append($INPUT.clone());var e=$DOM.find("input").pickadate();this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Open and close",function(){var e=this.picker;e.$node.click(),ok(!0===e.get("open"),"Opened with click in"),$("body").click(),ok(!1===e.get("open"),"Closed with click out")}),test("Open and close",function(){var e=this.picker;e.$node.click(),strictEqual(e.get("open"),!0,"Opened with click in"),e.$root.find("."+$.fn.pickadate.defaults.klass.buttonClose).click(),strictEqual(e.get("open"),!1,"Closed by clicking “close”")}),module("Base keyboard events",{setup:function(){$DOM.append($INPUT.clone());var e=$DOM.find("input").pickadate();this.picker=e.pickadate("picker")},teardown:function(){this.picker.stop(),$DOM.empty()}}),test("Open and close",function(){var e=this.picker;e.$node.focus(),ok(!0===e.get("open"),"Opened with key in"),e.$node.blur(),$DOM.focusin(),ok(!1===e.get("open"),"Closed with key out"),e.$node.trigger({type:"keydown",keyCode:40}),ok(!0===e.get("open"),"Opened after arrow “down”"),e.$node.trigger({type:"keydown",keyCode:27}),ok(!1===e.get("open"),"Closed after “escape”"),e.$node.trigger({type:"keydown",keyCode:38}),ok(!0===e.get("open"),"Opened after arrow “up”"),e.$node.trigger({type:"keydown",keyCode:8}),ok(!1===e.get("open"),"Closed after “backspace”"),e.$node.trigger({type:"keydown",keyCode:37}),ok(!0===e.get("open"),"Opened after arrow “left”"),e.$node.trigger({type:"keydown",keyCode:46}),ok(!1===e.get("open"),"Closed after “alt. backspace”"),e.$node.trigger({type:"keydown",keyCode:39}),ok(!0===e.get("open"),"Opened after arrow “right”")}),test("Set and clear",function(){var e=this.picker;e.open(),e.$node.trigger({type:"keydown",keyCode:13}),strictEqual(e.get("value"),e.get("select",$.fn.pickadate.defaults.format),"Set value as default selection after “enter”"),e.$node.trigger({type:"keydown",keyCode:8}),strictEqual(e.get("value"),"","Clear input value after “backspace”")});